{"version":3,"sources":["re_frisk/ui.cljs"],"mappings":"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","names":["re-frisk.ui/on-external-window-unload","app","re-frisk.inlined-deps.reagent.v1v0v0.reagent.dom/unmount-component-at-node","cljs.core.swap_BANG_","re-frisk.db/tool-state","cljs.core/assoc","re-frisk.ui/mount-external","window","doc","re-frame-data","re_frisk.ui.goog$module$goog$object.set","re-frisk.subs-graph/init","re_frisk.inlined_deps.reagent.v1v0v0.reagent.dom.render","re-frisk.ui.views/main-view","re-frisk.ui/open-debugger-window","map__73853","cljs.core/--destructure-map","cljs.core.get","ext_height","ext_width","cljs.core/deref","win","js/window.open","or__5045__auto__","re-frisk.ui.external-hml/html-doc","re-frisk.ui/on-iframe-load","iframe","js/document","re-frisk.ui/handle-toggle","left","re-frisk.utils/normalize-draggable","re-frisk.ui.components.drag/draggable","js/window.innerWidth","re-frisk.utils/closed?","re-frisk.ui/handle-keydown","e","input-elements","input-focused?","cljs.core/contains?","and__5043__auto__","cljs.core._EQ_","js/re-frisk","js/re-frisk.ui","js/re-frisk.ui.listener","re-frisk.ui/listener","js/window.addEventListener","re-frisk.ui/inner-view","ext-opened?","re-frisk.inlined-deps.reagent.v1v0v0.reagent.ratom/make-reaction","hidden","cljs.core.get_in","re-frisk.ui.style/inner-view-container","re-frisk.ui.style/external-button","re-frisk.ui.style/dragg-button","re-frisk.ui.components.drag/mouse-down-handler","re-frisk.ui/mount-internal","div"],"sourcesContent":["(ns re-frisk.ui\n  (:require-macros [re-frisk.inlined-deps.reagent.v1v0v0.reagent.ratom :refer [reaction]])\n  (:require [re-frisk.utils :as utils]\n            [re-frisk.ui.style :as style]\n            [re-frisk.inlined-deps.reagent.v1v0v0.reagent.dom :as rdom]\n            [re-frisk.ui.components.drag :as drag]\n            [re-frisk.ui.external-hml :as external-hml]\n            [re-frisk.db :as db]\n            [re-frisk.subs-graph :as subs-graph]\n            [re-frisk.ui.views :as ui.views]\n            [goog.object :as gobj]))\n\n(defn on-external-window-unload [app]\n  (fn []\n    (rdom/unmount-component-at-node app)\n    (swap! db/tool-state assoc :ext-win-opened? false)))\n\n(defn mount-external [window doc re-frame-data]\n  (let [app (.getElementById doc \"re-frisk-debugger-div\")]\n    (gobj/set window \"onunload\" (on-external-window-unload app))\n    (swap! db/tool-state assoc :ext-win-opened? true :doc doc)\n    (subs-graph/init window doc)\n    (rdom/render\n     [:div {:style {:height \"100%\"}}\n      [ui.views/main-view re-frame-data db/tool-state doc]]\n     app)))\n\n(defn open-debugger-window [re-frame-data]\n  (fn []\n    (let [{:keys [ext_height ext_width]} (:opts @db/tool-state)\n          win (js/window.open \"\" \"Debugger\" (str \"width=\" (or ext_width 800)\n                                                 \",height=\" (or ext_height 800)\n                                                 \",resizable=yes,scrollbars=yes,status=no\"\n                                                 \",directories=no,toolbar=no,menubar=no\"))\n          doc (.-document win)]\n      (.open doc)\n      (.write doc external-hml/html-doc)\n      (gobj/set win \"onload\" #(mount-external win doc re-frame-data))\n      (.close doc))))\n\n(defn on-iframe-load [re-frame-data]\n  (fn []\n    (let [iframe (.getElementById js/document \"re-frisk-iframe\")\n          doc (.-contentDocument iframe)\n          win (.-contentWindow iframe)]\n      (swap! db/tool-state assoc :doc doc)\n      (subs-graph/init win doc)\n      (rdom/render\n       [:div {:style {:height \"100%\"}}\n        [ui.views/main-view re-frame-data db/tool-state doc]]\n       (.getElementById doc \"re-frisk-debugger-div\")))))\n\n(defn handle-toggle []\n  (let [left (or (utils/normalize-draggable (:x @drag/draggable))\n                 (- js/window.innerWidth 30))]\n    (when-not (utils/closed? left)\n      (swap! db/tool-state assoc :latest-left (- js/window.innerWidth left)))\n    (swap! drag/draggable assoc :x (- js/window.innerWidth\n                                      (if (utils/closed? left) (:latest-left @db/tool-state) 30)))))\n\n(defn handle-keydown [e]\n  (let [input-elements #{\"INPUT\" \"SELECT\" \"TEXTAREA\"}\n        input-focused? (contains? input-elements  (.-tagName (.-target e)))]\n    (when (and (not input-focused?)\n               (= (.-key e) \"h\")\n               (.-ctrlKey e))\n      (.preventDefault e)\n      (handle-toggle))))\n\n(defonce listener (js/window.addEventListener \"keydown\" handle-keydown))\n\n(defn inner-view [re-frame-data]\n  (let [ext-opened? (reaction (:ext-win-opened? @db/tool-state))\n        hidden (get-in  @db/tool-state [:opts :hidden])]\n    (fn []\n      (when-not @ext-opened?\n        (let [left (or (utils/normalize-draggable (:x @drag/draggable))\n                       (- js/window.innerWidth 30))]\n          [:div {:style (style/inner-view-container left (:offset @drag/draggable))}\n           (when-not (and hidden (utils/closed? left))\n             [:div {:style {:display :flex :flex-direction :column :opacity 0.3}}\n              [:div {:style    style/external-button\n                     :on-click (open-debugger-window re-frame-data)}\n               \"\\u2197\"]\n              [:div {:style {:display :flex :flex 1 :justify-content :center :flex-direction :column}}\n               [:div {:style    style/external-button\n                      :on-click handle-toggle}\n                (if (utils/closed? left) \"\\u2b60\" \"\\u2b62\")]\n               [:div {:style         style/dragg-button\n                      :on-mouse-down drag/mouse-down-handler}]]])\n           (when-not (utils/closed? left)\n             [:div {:style {:display :flex :flex 1 :width \"100%\" :height \"100%\"}}\n              [:iframe {:id      \"re-frisk-iframe\" :src-doc external-hml/html-doc :width \"100%\" :height \"100%\"\n                        :style   (if (:offset @drag/draggable) {:pointer-events :none} {:pointer-events :all})\n                        :on-load (on-iframe-load re-frame-data)}]])])))))\n\n(defn mount-internal [re-frame-data]\n  (let [div (.createElement js/document \"div\")]\n    (gobj/set div \"style\"\n              (str \"position:fixed; top:0; left:0; bottom:0; right:0; width:100%; height:100%; border:none;\"\n                   \"margin:0; padding:0; z-index:999999999;pointer-events: none;\"))\n    (.appendChild (.-body js/document) div)\n    (rdom/render [inner-view re-frame-data] div)))"]}